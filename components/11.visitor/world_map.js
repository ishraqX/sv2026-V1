// world_map.js — Sound Vision Analytics v3
// Self-contained world map with REAL country outlines (152 countries)
// Zero external dependencies — no D3, no TopoJSON, no CDN fetches
// Equirectangular projection, viewBox 0 0 960 500
// UPDATED: Added Bangladesh/Dhaka timezone support

var WP={"US":"M147.5,115.6 152.0,116.1 168.0,113.9 226.1,113.9 226.1,114.4 253.6,121.9 258.4,122.8 260.3,132.5 269.3,130.3 279.2,125.0 289.3,125.0 291.5,130.3 301.3,125.6 293.1,133.3 278.1,152.2 264.0,163.6 253.3,166.7 245.3,166.7 241.1,169.4 229.3,168.1 220.3,178.1 216.0,176.7 210.7,167.2 202.7,167.8 196.0,161.7 184.0,162.8 167.7,159.7 158.7,154.4 148.8,136.7 147.5,115.6Z","AK":"M104.0,83.3 104.0,52.8 64.0,52.8 32.0,69.4 37.3,83.3 104.0,83.3Z","CA":"M106.7,83.3 120.0,84.2 133.3,98.1 146.9,112.8 226.1,113.9 253.6,121.9 258.4,122.8 277.3,127.8 289.3,125.0 306.7,119.4 317.3,122.2 321.1,117.8 337.3,119.4 330.7,105.6 308.8,82.5 304.0,76.4 297.3,75.0 288.0,63.9 298.7,54.2 266.7,48.1 250.7,47.2 224.0,48.6 186.7,55.6 160.0,57.5 128.0,56.9 106.7,56.9 106.7,83.3Z","MX":"M167.7,159.7 184.0,162.8 196.0,161.7 202.7,167.8 210.7,167.2 216.0,176.7 220.3,178.1 221.1,188.9 230.1,198.1 239.7,200.6 242.1,200.6 244.0,205.8 234.1,198.1 229.3,198.9 222.7,195.8 219.2,187.8 199.5,190.0 188.0,184.7 188.3,176.9 180.5,168.6 173.6,163.3 167.7,159.7Z","GT":"M234.1,200.6 242.1,200.6 244.0,205.8 242.1,205.8 239.7,206.4 238.4,208.1 235.5,206.4 234.1,200.6Z","BZ":"M242.1,198.6 244.5,198.6 244.5,205.8 242.1,205.8 242.1,198.6Z","HN":"M241.6,205.8 248.0,211.4 256.8,208.9 257.9,208.3 256.0,206.1 250.7,205.6 241.6,205.8Z","SV":"M239.7,211.1 244.0,211.4 246.1,213.6 240.5,211.4 239.7,211.1Z","NI":"M246.1,213.9 256.8,219.7 258.1,218.9 253.6,217.2 256.8,208.9 248.0,211.4 246.1,213.9Z","CR":"M250.9,218.9 259.7,223.3 259.7,227.2 256.8,227.8 253.1,222.2 250.9,218.9Z","PA":"M259.7,227.2 274.1,230.0 274.7,226.7 268.0,225.0 266.7,225.3 259.7,227.2Z","CU":"M253.3,187.8 261.9,185.6 266.7,185.6 280.0,194.4 281.3,194.7 273.3,194.7 253.3,187.8Z","HT":"M282.7,198.3 288.8,194.7 288.8,198.3 282.7,198.3Z","DO":"M288.8,194.7 297.9,194.7 297.9,199.4 288.8,199.4 288.8,194.7Z","JM":"M270.9,198.6 276.8,198.6 276.8,200.8 270.9,200.8 270.9,198.6Z","PR":"M300.5,198.6 305.1,198.6 305.1,200.3 300.5,200.3 300.5,198.6Z","TT":"M314.9,219.7 317.6,219.7 317.6,222.2 314.9,222.2 314.9,219.7Z","CO":"M273.9,225.8 287.2,215.6 290.7,216.7 300.5,220.8 310.9,222.2 314.7,233.3 318.1,237.5 301.3,244.4 293.3,261.7 285.6,255.8 272.5,250.0 269.3,246.9 272.0,243.6 273.9,225.8Z","VE":"M284.3,218.3 287.2,215.6 312.8,218.9 320.0,226.4 317.3,233.3 310.9,238.9 305.9,248.1 301.3,244.4 300.5,238.9 290.7,230.8 286.9,223.6 284.3,218.3Z","GY":"M327.2,228.9 320.5,226.9 320.0,231.4 317.3,233.3 320.0,238.9 327.2,236.1 327.2,228.9Z","SR":"M336.0,233.6 327.2,236.1 327.2,240.0 333.3,244.4 336.0,233.6Z","GF":"M336.0,233.6 342.4,238.3 342.4,244.4 336.0,244.4 336.0,233.6Z","BR":"M386.9,269.4 380.0,280.6 376.0,293.1 369.3,305.6 362.7,313.9 350.7,325.6 337.1,343.6 338.7,341.7 324.0,338.9 324.0,325.6 326.7,320.8 313.1,311.7 312.0,300.0 320.0,294.4 320.0,287.5 312.0,283.3 307.2,277.8 298.7,280.6 293.3,276.9 283.7,264.4 284.8,256.1 293.3,248.6 296.0,247.2 301.3,244.4 305.9,248.1 320.0,261.1 341.3,243.1 346.7,238.3 360.5,244.2 380.8,250.6 386.9,269.4Z","EC":"M266.7,256.1 279.2,250.3 277.3,250.3 272.5,250.0 269.3,246.9 279.5,247.2 285.3,256.1 277.3,263.9 266.7,261.1 266.7,256.1Z","PE":"M263.2,261.9 266.7,261.1 277.3,263.9 285.3,272.2 293.3,276.9 298.7,280.6 307.2,289.7 295.2,298.6 295.2,300.0 280.0,295.3 274.1,288.9 265.3,272.5 263.2,261.9Z","BO":"M295.2,298.6 307.2,289.7 320.0,294.4 324.0,297.2 326.7,305.6 313.1,311.7 312.0,311.1 301.3,313.6 298.7,311.1 300.0,302.8 295.2,298.6Z","PY":"M326.7,305.6 326.7,311.1 322.7,316.7 313.9,311.1 313.1,311.7 326.7,305.6Z","AR":"M337.1,343.6 326.7,355.6 313.9,366.7 310.7,375.0 305.3,386.1 298.7,394.4 305.3,402.8 312.0,402.8 304.0,404.7 297.1,402.5 306.7,402.8 298.7,394.4 293.3,388.9 288.0,381.9 290.7,366.7 289.3,355.6 292.0,333.3 298.7,325.0 301.3,313.6 312.0,311.1 313.1,311.7 326.7,311.1 326.7,305.6 324.0,305.6 324.0,325.6 324.0,338.9 337.1,343.6Z","CL":"M292.0,333.3 289.3,355.6 288.0,381.9 282.7,394.4 297.1,402.5 306.7,402.8 304.0,404.7 298.7,394.4 305.3,386.1 310.7,375.0 301.3,375.0 296.0,366.7 290.7,350.0 292.0,333.3Z","UY":"M324.0,338.9 337.1,343.6 338.7,341.7 337.3,333.3 325.9,334.2 324.0,338.9Z","IS":"M416.0,73.6 421.3,73.6 432.0,72.2 444.0,68.9 444.0,65.3 429.3,65.3 416.0,68.1 416.0,73.6Z","IE":"M452.0,106.9 464.0,107.2 464.0,100.0 458.1,96.7 452.0,100.0 452.0,106.9Z","GB":"M465.3,111.4 478.7,106.9 482.7,106.9 480.5,101.4 478.7,97.2 472.0,87.5 466.7,86.7 463.5,88.9 468.0,89.7 466.7,100.0 471.5,101.4 465.3,111.4Z","PT":"M454.7,147.5 463.2,147.5 461.6,141.7 461.6,133.6 454.7,133.3 454.7,147.5Z","ES":"M454.7,128.3 472.0,128.6 488.8,132.2 488.5,137.5 480.5,146.7 474.7,148.6 465.6,150.0 454.7,147.5 454.7,128.3Z","FR":"M475.2,129.4 488.0,129.7 500.5,128.9 498.4,127.8 498.7,118.1 493.3,112.5 486.9,108.1 474.7,108.3 475.2,119.4 475.2,129.4Z","BE":"M486.7,107.5 496.3,108.9 495.5,112.2 488.0,112.5 486.7,107.5Z","NL":"M488.8,107.2 499.2,102.2 496.0,101.4 490.7,102.2 488.8,107.2Z","DE":"M496.0,108.3 501.3,97.8 517.6,99.4 520.0,108.1 513.3,110.3 516.8,114.4 505.3,118.1 500.3,117.8 496.0,112.5 496.0,108.3Z","CH":"M496.0,117.8 508.0,118.1 508.0,121.4 501.3,122.8 496.0,121.1 496.0,117.8Z","AT":"M505.3,118.1 514.7,118.1 525.6,116.7 525.6,119.4 520.0,120.6 505.3,120.8 505.3,118.1Z","IT":"M498.7,127.8 516.0,127.8 521.3,144.4 522.7,145.8 521.3,144.7 513.1,145.0 509.3,145.8 505.6,138.9 501.3,137.2 504.0,127.8 498.7,127.8Z","PL":"M517.6,99.4 540.8,98.6 542.7,105.6 544.0,108.9 530.1,111.4 525.3,110.3 520.0,108.1 517.6,99.4Z","CZ":"M516.8,108.1 530.1,110.3 529.3,112.5 525.1,115.0 516.0,115.0 516.8,108.1Z","SK":"M525.3,112.5 540.3,112.2 539.2,115.6 525.6,116.9 525.3,112.5Z","HU":"M522.9,119.4 540.3,116.4 539.2,115.6 525.3,116.7 522.9,119.4Z","RO":"M539.2,115.6 559.2,124.4 560.0,123.6 556.3,122.2 558.7,119.4 553.3,115.3 540.3,115.0 539.2,115.6Z","BG":"M540.0,127.8 554.7,128.6 556.3,128.6 554.7,133.3 544.0,134.7 538.7,133.3 540.0,127.8Z","GR":"M533.3,133.3 550.7,135.3 550.7,138.9 543.2,145.3 538.7,147.2 534.7,147.2 533.3,141.7 533.3,133.3Z","RS":"M530.7,121.7 540.0,127.8 538.7,129.2 533.3,130.6 530.7,129.2 530.7,121.7Z","HR":"M516.0,123.6 525.1,120.8 525.3,122.8 518.7,124.4 516.0,123.6Z","BA":"M525.1,124.2 529.3,124.7 530.7,126.4 524.0,129.2 521.9,129.2 525.1,124.2Z","AL":"M532.0,133.3 534.7,133.3 534.7,137.5 531.5,138.9 532.0,133.3Z","MK":"M534.7,132.5 540.0,132.5 540.0,135.6 534.7,135.6 534.7,132.5Z","UA":"M539.2,105.3 565.3,104.7 579.7,118.3 581.9,119.2 569.3,125.0 561.9,122.2 558.9,124.2 553.3,123.6 544.0,116.9 539.2,105.3Z","BY":"M544.0,104.2 567.2,100.3 566.7,105.6 544.0,108.9 540.8,107.5 544.0,104.2Z","LT":"M536.0,91.9 550.9,94.4 550.9,100.0 540.8,98.6 536.0,91.9Z","LV":"M536.0,90.3 554.1,90.8 555.2,94.4 536.0,91.9 536.0,90.3Z","EE":"M538.7,84.7 555.2,88.1 554.1,90.8 538.7,90.3 538.7,84.7Z","FI":"M534.9,84.7 554.4,81.9 559.5,80.6 559.5,75.0 554.7,69.4 549.3,67.5 545.3,83.3 534.9,84.7Z","SE":"M509.3,94.4 517.3,95.8 544.5,67.8 534.9,73.6 528.0,83.3 512.0,88.9 509.3,94.4Z","NO":"M492.8,88.9 500.8,88.9 518.7,93.1 536.0,73.6 554.7,52.8 533.3,53.6 517.3,55.6 498.7,88.9 492.8,88.9Z","DK":"M501.3,97.2 513.9,96.4 513.9,94.2 508.0,89.7 501.9,91.7 501.3,97.2Z","MD":"M553.3,115.3 560.5,122.2 554.7,123.6 551.7,119.4 553.3,115.3Z","TR":"M549.3,133.3 576.0,133.3 597.3,138.9 599.5,147.2 592.0,147.2 576.0,150.0 560.0,150.0 552.0,147.2 549.3,144.4 549.3,133.3Z","GE":"M589.3,129.2 604.0,134.7 604.0,131.9 589.3,129.2Z","AM":"M596.0,135.6 604.0,134.7 604.0,141.7 596.0,141.7 596.0,135.6Z","AZ":"M604.0,133.3 614.4,137.8 614.4,143.3 604.0,143.1 604.0,133.3Z","RU":"M554.7,63.9 586.7,69.4 640.0,61.1 693.3,45.8 746.7,47.2 800.0,47.2 853.3,50.0 912.0,61.1 914.7,86.1 880.0,86.1 840.0,116.7 826.7,130.6 826.7,116.7 800.0,102.8 746.7,105.6 693.3,105.6 640.0,97.2 626.7,100.0 613.3,108.3 597.3,130.6 586.7,127.8 581.3,119.4 579.7,118.3 581.3,97.2 565.3,104.7 554.7,91.7 554.7,63.9Z","SY":"M576.0,147.2 593.1,146.4 593.1,155.6 583.5,157.2 578.1,158.3 576.0,158.3 576.0,147.2Z","LB":"M573.6,155.8 577.6,153.9 577.6,158.3 573.6,157.8 573.6,155.8Z","IL":"M572.0,161.1 575.5,157.5 578.1,158.3 575.2,165.6 572.0,168.1 572.0,161.1Z","JO":"M578.1,158.3 584.0,161.1 584.5,163.9 578.7,170.8 573.3,168.6 575.2,165.6 578.1,158.3Z","IQ":"M584.5,157.5 601.1,144.7 609.6,154.2 609.3,166.7 604.0,169.4 599.2,170.8 587.7,161.4 584.5,157.5Z","SA":"M577.3,170.8 610.9,168.1 630.4,181.9 636.0,184.4 626.7,188.9 617.6,183.1 615.5,180.6 609.1,170.8 599.2,170.8 587.7,161.4 580.0,163.9 577.3,170.8Z","YE":"M593.3,200.0 625.3,202.8 628.3,214.7 618.7,217.2 601.3,219.4 596.0,215.0 596.0,210.0 593.3,208.3 593.3,200.0Z","OM":"M628.3,188.9 637.3,188.9 640.0,187.5 634.7,194.4 626.7,204.2 618.7,200.0 628.3,188.9Z","AE":"M617.6,183.1 630.4,181.9 630.9,185.6 626.7,188.9 617.6,183.1Z","QA":"M615.5,180.6 617.6,177.2 617.6,183.1 615.5,180.6Z","KW":"M604.0,166.4 609.6,168.1 605.3,170.8 604.0,169.4 604.0,166.4Z","IR":"M597.3,138.9 609.6,143.1 624.0,145.8 642.1,147.2 648.5,150.6 642.7,162.5 636.0,179.2 626.7,178.3 615.5,178.3 599.2,170.8 597.3,147.2 597.3,138.9Z","AF":"M642.7,150.3 657.3,145.8 670.7,144.4 679.7,146.7 670.9,153.6 664.5,154.2 657.3,166.7 642.7,162.5 642.7,150.3Z","KZ":"M616.0,107.8 640.0,97.2 693.3,105.6 694.7,108.3 672.0,108.3 653.3,106.9 640.0,127.8 620.0,133.9 616.0,107.8Z","UZ":"M629.3,135.3 657.3,133.3 661.3,138.9 650.7,145.8 640.0,148.1 629.3,144.4 629.3,135.3Z","TM":"M621.3,145.8 641.3,145.8 646.7,152.8 640.0,161.1 629.3,152.8 621.3,145.8Z","KG":"M666.7,138.1 694.7,136.1 693.9,138.9 670.7,140.3 666.7,138.1Z","TJ":"M660.0,138.9 674.7,140.3 679.7,146.7 670.7,148.1 660.0,146.7 660.0,138.9Z","PK":"M642.1,147.2 679.7,146.7 670.9,153.6 672.8,163.9 665.3,175.0 650.7,186.1 642.7,181.9 640.0,179.2 636.0,179.2 642.7,162.5 642.1,147.2Z","IN":"M661.9,184.2 673.6,184.7 686.7,171.1 693.3,175.0 714.7,173.6 732.3,188.9 725.3,200.0 694.1,222.2 686.7,227.8 682.7,226.4 694.1,219.4 684.0,197.2 673.3,188.9 661.9,184.2Z","NP":"M693.6,170.0 715.2,175.8 714.7,173.6 693.3,175.0 693.6,170.0Z","BD":"M714.7,176.4 727.2,176.9 726.7,188.9 714.7,190.3 714.7,176.4Z","LK":"M693.9,222.2 698.7,220.8 698.1,228.6 693.3,229.2 693.9,222.2Z","MM":"M725.9,171.7 740.0,170.8 747.2,194.4 745.3,200.0 740.0,205.6 742.7,222.2 745.3,231.9 742.1,234.4 738.7,229.2 732.3,205.6 725.9,188.9 725.9,171.7Z","TH":"M741.3,198.6 753.3,201.4 753.3,216.7 749.3,234.7 745.9,238.9 745.9,233.3 746.9,234.4 750.7,233.3 753.3,232.8 756.0,227.8 752.0,216.7 754.7,211.1 748.0,198.6 741.3,198.6Z","LA":"M753.3,187.5 757.3,188.9 762.7,194.4 760.0,202.8 753.3,201.4 753.3,187.5Z","VN":"M757.3,188.9 768.0,190.3 769.3,205.6 770.7,216.7 764.0,222.2 758.7,220.8 753.3,216.7 757.3,202.8 757.3,188.9Z","KH":"M753.3,209.7 762.7,209.7 764.0,216.7 758.7,220.8 753.3,216.7 753.3,209.7Z","MY":"M756.0,245.8 756.8,241.7 756.0,234.7 753.3,232.8 750.7,233.3 746.9,234.4 745.9,233.3 749.3,238.9 753.3,245.8 756.0,245.8Z","MY2":"M788.0,229.2 796.0,229.7 790.7,238.9 784.0,237.5 788.0,229.2Z","SG":"M756.3,245.8 757.3,245.8 757.3,246.9 756.3,246.9 756.3,245.8Z","ID":"M734.7,234.4 757.3,243.1 762.7,265.3 766.7,269.4 784.0,270.8 788.5,273.6 790.7,273.6 805.3,273.6 810.7,275.0 813.3,273.6 826.7,255.6 840.0,263.9 856.0,256.7 856.0,275.0 829.3,272.2 813.3,276.4 800.0,279.2 786.7,275.0 766.7,272.2 760.0,268.9 758.7,248.6 756.0,244.4 746.7,244.4 736.0,236.1 734.7,234.4Z","PH":"M792.5,198.1 805.3,198.6 816.0,226.4 816.0,230.6 810.7,228.3 806.7,229.2 800.0,222.2 794.7,220.8 792.5,198.1Z","TW":"M800.0,179.7 805.3,180.6 804.0,188.9 800.0,189.4 800.0,179.7Z","CN":"M676.0,137.5 694.7,131.9 713.3,113.9 789.3,111.1 829.3,129.2 825.3,138.9 805.3,150.0 804.0,163.9 792.0,181.9 769.3,195.8 758.7,191.7 748.0,187.5 741.3,183.3 740.0,170.8 714.7,173.6 692.0,163.9 688.0,152.8 679.7,146.7 676.0,137.5Z","MN":"M714.7,112.5 789.3,111.1 798.7,112.5 798.7,122.2 760.0,134.7 714.1,120.8 714.7,112.5Z","KP":"M812.0,138.9 825.3,138.9 824.0,144.4 817.3,145.8 812.0,143.1 812.0,138.9Z","KR":"M812.0,143.1 825.3,143.1 824.0,152.8 816.0,154.2 812.0,151.4 812.0,143.1Z","JP":"M853.3,138.9 864.0,129.2 857.3,123.6 857.3,136.1 853.3,143.1 853.3,152.8 829.3,158.3 829.3,156.9 840.0,154.2 845.3,148.6 848.0,141.7 853.3,138.9Z","JP2":"M857.3,129.2 868.0,129.2 868.0,134.7 857.3,134.7 857.3,129.2Z","MA":"M444.0,150.0 474.7,151.4 480.0,154.2 476.0,168.1 466.7,172.2 454.7,172.2 444.0,173.6 444.0,150.0Z","DZ":"M474.7,151.4 502.7,147.2 505.3,163.9 505.3,194.4 488.0,195.8 480.0,195.8 466.7,194.4 466.7,172.2 476.0,168.1 480.0,154.2 474.7,151.4Z","TN":"M502.7,147.2 509.3,146.4 510.7,158.3 505.3,163.9 502.7,147.2Z","LY":"M505.3,163.9 514.7,158.3 533.3,161.1 546.7,162.5 546.7,188.9 520.0,186.1 505.3,183.3 505.3,163.9Z","EG":"M546.7,188.9 578.1,188.9 578.7,173.6 573.1,168.1 572.0,166.7 562.7,166.7 546.7,162.5 546.7,188.9Z","SD":"M546.7,188.9 578.7,188.9 584.0,195.8 586.7,206.9 580.0,211.1 577.3,222.2 570.7,218.1 552.0,220.8 544.0,208.3 546.7,188.9Z","ET":"M568.0,208.3 577.3,208.3 594.7,218.1 597.3,227.8 592.0,238.9 582.7,240.3 576.0,234.7 568.0,230.6 568.0,208.3Z","SO":"M592.0,216.7 616.0,216.7 617.3,225.0 597.3,227.8 594.7,218.1 592.0,216.7Z","MR":"M434.7,206.9 466.7,202.8 480.0,208.3 448.0,208.3 434.7,206.9Z","ML":"M448.0,208.3 465.3,208.3 465.3,218.1 469.3,216.7 485.3,215.6 491.5,196.7 480.0,208.3 466.7,202.8 448.0,208.3Z","NE":"M485.3,215.6 518.7,213.9 519.5,202.8 489.3,197.2 480.0,208.3 485.3,215.6Z","TD":"M518.7,213.9 542.7,213.9 542.7,197.2 520.0,186.1 519.5,202.8 518.7,213.9Z","NG":"M487.2,232.2 498.7,237.5 505.3,231.9 518.7,213.9 518.7,225.0 514.7,212.5 502.7,213.9 489.3,218.1 487.2,232.2Z","CM":"M502.7,213.9 520.0,213.9 522.7,229.2 518.7,238.3 506.7,244.4 502.7,241.7 502.7,213.9Z","CF":"M518.7,238.3 542.7,237.5 552.0,236.1 552.0,230.6 518.7,213.9 518.7,238.3Z","GH":"M471.5,219.4 482.7,219.4 483.2,230.6 478.7,234.7 471.5,236.1 471.5,219.4Z","CI":"M457.3,226.4 471.5,219.4 471.5,236.1 465.3,237.5 457.3,237.5 457.3,226.4Z","BF":"M465.3,208.3 485.3,215.6 487.2,223.1 471.5,219.4 465.3,218.1 465.3,208.3Z","SN":"M433.3,208.9 441.3,203.6 449.3,204.2 449.3,215.3 436.0,215.3 433.3,208.9Z","GN":"M440.0,218.1 449.3,215.3 449.3,222.2 446.7,229.2 440.0,229.2 440.0,218.1Z","SL":"M440.0,222.2 449.3,222.2 449.3,229.2 442.7,229.7 440.0,226.4 440.0,222.2Z","LR":"M449.3,229.2 460.0,237.5 457.3,237.5 449.3,229.2Z","GA":"M502.7,241.7 518.7,241.7 518.7,250.0 505.3,250.0 502.7,241.7Z","CG":"M518.7,238.3 522.7,237.5 529.3,240.3 529.3,244.4 518.7,244.4 518.7,238.3Z","CD":"M529.3,236.1 553.3,236.1 562.1,245.8 560.0,263.9 556.0,272.2 546.7,279.2 541.3,275.0 528.0,263.9 522.7,250.0 529.3,240.3 529.3,236.1Z","AO":"M512.0,263.9 528.0,263.9 544.0,279.2 544.0,300.0 533.3,301.4 517.3,297.2 510.7,287.5 512.0,263.9Z","ZM":"M538.7,273.6 562.1,272.2 569.3,283.3 560.0,293.1 553.3,298.6 544.0,298.6 538.4,286.1 538.7,273.6Z","MW":"M569.3,277.8 575.5,281.9 575.5,295.8 570.7,297.2 569.3,288.9 569.3,277.8Z","MZ":"M575.5,281.9 588.0,281.9 588.0,291.7 577.3,305.6 573.3,323.6 565.3,323.6 569.3,313.9 572.0,302.8 569.3,294.4 570.7,283.3 575.5,281.9Z","ZW":"M553.3,298.6 567.2,294.4 569.3,306.9 562.7,312.5 553.3,308.3 553.3,298.6Z","BW":"M533.3,300.0 546.7,300.0 554.7,306.9 553.3,323.6 544.0,327.8 533.3,323.6 533.3,300.0Z","NA":"M511.2,298.6 533.3,301.4 533.3,323.6 529.3,338.9 524.0,330.0 511.2,327.8 511.2,298.6Z","ZA":"M524.0,330.0 538.7,344.2 556.0,343.1 564.0,331.9 568.0,325.0 569.3,313.9 565.3,323.6 556.0,333.3 553.3,343.1 538.7,344.4 528.0,345.6 524.0,330.0Z","TZ":"M558.1,252.8 572.0,252.8 588.0,281.9 575.5,281.9 575.5,277.8 571.5,276.4 560.0,272.2 556.0,272.2 558.1,252.8Z","KE":"M570.7,252.8 592.0,254.2 590.7,258.3 588.0,281.9 572.0,252.8 570.7,252.8Z","UG":"M558.9,254.2 570.7,252.8 570.4,238.3 562.7,238.9 558.7,244.4 558.9,254.2Z","RW":"M557.3,252.8 562.1,252.8 562.1,257.8 557.3,257.8 557.3,252.8Z","BI":"M557.3,257.8 562.1,257.8 560.0,262.5 557.3,262.5 557.3,257.8Z","SS":"M546.7,220.8 570.7,218.1 577.3,222.2 568.0,230.6 560.0,238.9 552.0,238.9 546.7,220.8Z","MG":"M597.1,284.7 614.7,294.4 614.7,320.8 597.3,320.8 597.1,284.7Z","AU":"M782.7,311.1 805.3,344.4 824.0,347.2 829.3,333.3 845.3,348.6 853.3,355.6 862.7,358.3 873.3,355.6 888.0,327.8 885.3,318.1 878.7,308.3 872.0,304.2 866.7,291.7 858.7,280.6 842.7,283.3 826.7,280.6 817.3,290.3 805.3,300.0 782.7,311.1Z","NZ":"M940.0,345.8 956.3,354.2 948.0,361.1 941.3,365.3 933.3,369.4 930.7,379.2 928.0,377.8 926.7,372.2 929.3,370.8 933.3,372.2 940.0,345.8Z","PG":"M856.0,256.7 880.0,266.7 874.7,276.4 856.0,275.0 856.0,256.7Z"};

(function(){
'use strict';

// Country name lookup (ISO2 → display name)
var CN={
  US:'United States',CA:'Canada',MX:'Mexico',GT:'Guatemala',BZ:'Belize',
  HN:'Honduras',SV:'El Salvador',NI:'Nicaragua',CR:'Costa Rica',PA:'Panama',
  CU:'Cuba',HT:'Haiti',DO:'Dominican Rep.',JM:'Jamaica',PR:'Puerto Rico',TT:'Trinidad',
  CO:'Colombia',VE:'Venezuela',GY:'Guyana',SR:'Suriname',BR:'Brazil',
  EC:'Ecuador',PE:'Peru',BO:'Bolivia',PY:'Paraguay',AR:'Argentina',CL:'Chile',UY:'Uruguay',
  IS:'Iceland',IE:'Ireland',GB:'United Kingdom',PT:'Portugal',ES:'Spain',
  FR:'France',BE:'Belgium',NL:'Netherlands',DE:'Germany',CH:'Switzerland',
  AT:'Austria',IT:'Italy',PL:'Poland',CZ:'Czechia',SK:'Slovakia',HU:'Hungary',
  RO:'Romania',BG:'Bulgaria',GR:'Greece',RS:'Serbia',HR:'Croatia',
  BA:'Bosnia',AL:'Albania',MK:'North Macedonia',UA:'Ukraine',BY:'Belarus',
  LT:'Lithuania',LV:'Latvia',EE:'Estonia',FI:'Finland',SE:'Sweden',
  NO:'Norway',DK:'Denmark',MD:'Moldova',TR:'Turkey',
  GE:'Georgia',AM:'Armenia',AZ:'Azerbaijan',RU:'Russia',
  SY:'Syria',LB:'Lebanon',IL:'Israel',JO:'Jordan',IQ:'Iraq',
  SA:'Saudi Arabia',YE:'Yemen',OM:'Oman',AE:'UAE',QA:'Qatar',KW:'Kuwait',
  IR:'Iran',AF:'Afghanistan',
  KZ:'Kazakhstan',UZ:'Uzbekistan',TM:'Turkmenistan',KG:'Kyrgyzstan',TJ:'Tajikistan',
  PK:'Pakistan',IN:'India',NP:'Nepal',BD:'Bangladesh',LK:'Sri Lanka',MM:'Myanmar',
  TH:'Thailand',LA:'Laos',VN:'Vietnam',KH:'Cambodia',MY:'Malaysia',SG:'Singapore',
  ID:'Indonesia',PH:'Philippines',TW:'Taiwan',
  CN:'China',MN:'Mongolia',KP:'North Korea',KR:'South Korea',JP:'Japan',
  MA:'Morocco',DZ:'Algeria',TN:'Tunisia',LY:'Libya',EG:'Egypt',
  SD:'Sudan',ET:'Ethiopia',SO:'Somalia',MR:'Mauritania',ML:'Mali',NE:'Niger',
  TD:'Chad',NG:'Nigeria',CM:'Cameroon',CF:'C. African Rep.',GH:'Ghana',
  CI:'Côte d\'Ivoire',BF:'Burkina Faso',SN:'Senegal',GN:'Guinea',SL:'Sierra Leone',
  LR:'Liberia',GA:'Gabon',CG:'Congo',CD:'DR Congo',AO:'Angola',ZM:'Zambia',
  MW:'Malawi',MZ:'Mozambique',ZW:'Zimbabwe',BW:'Botswana',NA:'Namibia',
  ZA:'South Africa',TZ:'Tanzania',KE:'Kenya',UG:'Uganda',RW:'Rwanda',
  BI:'Burundi',SS:'South Sudan',MG:'Madagascar',
  AU:'Australia',NZ:'New Zealand',PG:'Papua New Guinea'
};

window.drawWorldMap = function(){
  var container = document.getElementById('map-container');
  var svgEl     = document.getElementById('world-map');
  var tooltip   = document.getElementById('map-tooltip');
  if(!container || !svgEl) return;

  var mapData     = (typeof DB_DATA!=='undefined') ? (DB_DATA.countryMap||[]) : [];
  var totalVisits = mapData.reduce(function(s,d){return s+d.count;},0)||1;
  var maxCount    = Math.max.apply(null,mapData.map(function(d){return d.count;}).concat([1]));

  // Build lookup iso2→data
  var lookup={};
  mapData.forEach(function(d){lookup[d.code.toUpperCase()]=d;});

  // Color interpolation: dark navy → electric blue
  function colorFor(count){
    if(!count) return null;
    var t=Math.pow(count/maxCount, 0.4);
    return 'rgb('+
      Math.round(13+t*(37-13))+','+
      Math.round(31+t*(99-31))+','+
      Math.round(53+t*(235-53))+')';
  }
  function hoverColorFor(count){
    if(!count) return null;
    var t=Math.min(1,Math.pow(count/maxCount,0.4)+0.25);
    return 'rgb('+
      Math.round(13+t*(96-13))+','+
      Math.round(31+t*(165-31))+','+
      Math.round(53+t*(250-53))+')';
  }

  var W=container.clientWidth||960;
  svgEl.setAttribute('viewBox','0 0 960 500');
  svgEl.setAttribute('width',W);
  svgEl.setAttribute('height',Math.round(W*500/960));
  svgEl.setAttribute('preserveAspectRatio','xMidYMid meet');
  svgEl.style.display='block';

  while(svgEl.firstChild) svgEl.removeChild(svgEl.firstChild);

  var NS='http://www.w3.org/2000/svg';
  function el(tag,attrs){
    var e=document.createElementNS(NS,tag);
    for(var k in (attrs||{})) e.setAttribute(k,attrs[k]);
    return e;
  }

  // ── Defs ──────────────────────────────────────────────────
  var defs=el('defs');

  // Country glow filter
  var f1=el('filter',{id:'cglow',x:'-30%',y:'-30%',width:'160%',height:'160%'});
  var fb=el('feGaussianBlur',{in:'SourceAlpha',stdDeviation:'3',result:'blur'});
  var ff=el('feFlood',{'flood-color':'#3b82f6','flood-opacity':'0.6',result:'color'});
  var fc=el('feComposite',{in:'color',in2:'blur',operator:'in',result:'shadow'});
  var fm=el('feMerge');
  fm.appendChild(el('feMergeNode',{in:'shadow'}));
  fm.appendChild(el('feMergeNode',{in:'SourceGraphic'}));
  f1.appendChild(fb);f1.appendChild(ff);f1.appendChild(fc);f1.appendChild(fm);

  // Dot glow filter
  var f2=el('filter',{id:'dotglow',x:'-80%',y:'-80%',width:'260%',height:'260%'});
  var fb2=el('feGaussianBlur',{stdDeviation:'3',result:'b'});
  var fm2=el('feMerge');
  fm2.appendChild(el('feMergeNode',{in:'b'}));
  fm2.appendChild(el('feMergeNode',{in:'SourceGraphic'}));
  f2.appendChild(fb2);f2.appendChild(fm2);

  // Scan line gradient
  var sg=el('linearGradient',{id:'sG',x1:'0',y1:'0',x2:'1',y2:'0'});
  [{o:'0%',c:'transparent',a:'0'},{o:'35%',c:'#60a5fa',a:'0.6'},
   {o:'65%',c:'#93c5fd',a:'0.9'},{o:'100%',c:'transparent',a:'0'}].forEach(function(s){
    var st=el('stop',{offset:s.o});
    st.setAttribute('style','stop-color:'+s.c+';stop-opacity:'+s.a);
    sg.appendChild(st);
  });

  // Ocean gradient
  var og=el('radialGradient',{id:'oG',cx:'50%',cy:'50%',r:'70%'});
  [{o:'0%',c:'#061428'},{o:'100%',c:'#020810'}].forEach(function(s){
    var st=el('stop',{offset:s.o});
    st.setAttribute('style','stop-color:'+s.c);
    og.appendChild(st);
  });

  defs.appendChild(f1);defs.appendChild(f2);defs.appendChild(sg);defs.appendChild(og);
  svgEl.appendChild(defs);

  // ── Ocean ─────────────────────────────────────────────────
  svgEl.appendChild(el('rect',{x:0,y:0,width:960,height:500,fill:'url(#oG)'}));

  // ── Graticule ─────────────────────────────────────────────
  var gG=el('g',{fill:'none',opacity:'0.35'});
  // Latitude lines
  [-60,-30,0,30,60].forEach(function(lat){
    var y=Math.round((90-lat)/180*500);
    var style=lat===0?'stroke:#1e40af;stroke-width:0.8':'stroke:#0e2a4a;stroke-width:0.4';
    gG.appendChild(el('line',{x1:0,y1:y,x2:960,y2:y,style:style}));
  });
  // Longitude lines
  [-150,-120,-90,-60,-30,0,30,60,90,120,150].forEach(function(lon){
    var x=Math.round((lon+180)/360*960);
    gG.appendChild(el('line',{x1:x,y1:0,x2:x,y2:500,style:'stroke:#0e2a4a;stroke-width:0.4'}));
  });
  svgEl.appendChild(gG);

  // ── Country paths ──────────────────────────────────────────
  var cG=el('g');
  Object.keys(WP).forEach(function(code){
    // Handle duplicate keys (RU2, MY2 etc.) — map to parent
    var lookupCode=code.replace(/\d+$/,'');
    var info=lookup[lookupCode.toUpperCase()];
    var hasData=!!info;
    var baseFill=hasData?(colorFor(info.count)||'#0f2845'):'#0a1a2e';
    var stroke=hasData?'rgba(59,130,246,0.5)':'rgba(14,42,74,0.8)';

    var pathEl=el('path',{
      d:WP[code],
      fill:baseFill,
      stroke:stroke,
      'stroke-width':hasData?'0.7':'0.4',
      'stroke-linejoin':'round',
      'stroke-linecap':'round'
    });

    if(hasData){
      pathEl.style.cursor='pointer';
      var hoverFill=hoverColorFor(info.count)||baseFill;

      pathEl.addEventListener('mousemove',function(e){
        if(!tooltip) return;
        var rect=container.getBoundingClientRect();
        var tx=e.clientX-rect.left+20,ty=e.clientY-rect.top-15;
        var ttc=document.getElementById('tt-country');
        var ttv=document.getElementById('tt-count');
        var ttp=document.getElementById('tt-pct');
        if(ttc) ttc.textContent=info.name;
        if(ttv) ttv.textContent=info.count.toLocaleString()+' visits';
        if(ttp) ttp.textContent=((info.count/totalVisits)*100).toFixed(1)+'% of traffic';
        tooltip.style.display='block';
        tooltip.style.left=Math.min(tx,container.clientWidth-200)+'px';
        tooltip.style.top=Math.max(ty,8)+'px';
        this.setAttribute('fill',hoverFill);
        this.setAttribute('stroke','#60a5fa');
        this.setAttribute('stroke-width','1.2');
        this.setAttribute('filter','url(#cglow)');
      });
      pathEl.addEventListener('mouseleave',function(){
        if(tooltip) tooltip.style.display='none';
        this.setAttribute('fill',baseFill);
        this.setAttribute('stroke',stroke);
        this.setAttribute('stroke-width','0.7');
        this.removeAttribute('filter');
      });
    }
    cG.appendChild(pathEl);
  });
  svgEl.appendChild(cG);

  // ── Animated pulse dots on top visitor countries ───────────
  // Accurate lon/lat centroids
  var centroids={
    BD:[90.4,23.7],IN:[78.9,20.6],US:[263,130],CN:[104,35],
    GB:[440,90],PK:[69.3,30.4],BR:[316,258],NG:[8.7,9.1],
    ID:[750,248],AU:[785,270],DE:[10.5,51.2],FR:[2.3,46.2],
    JP:[138.3,36.2],RU:[560,65],ZA:[25.1,290],TR:[35.2,38.9],
    SA:[45.0,24.0],EG:[30.8,26.8],ET:[40.5,8.6],KE:[37.9,245],
    TH:[100.9,15.0],VN:[108.3,16.6],PH:[121.8,12.9],MY:[101.9,4.2],
    CA:[235,90],MX:[195,160],AR:[290,312],CO:[270,206],PL:[19.1,51.9],
    UA:[32.0,49.0],IR:[53.7,32.4],MM:[96.7,19.2],KR:[127.5,37.0],
    ES:[-3.7,40.4],IT:[12.6,42.8],SE:[18.6,59.3],MA:[-7,32],
    TZ:[34.8,244],TW:[121,24],IQ:[43,33],SY:[38,35]
  };

  function toXY(c){
    // If abs(y)>90 it's already in SVG pixel coords
    if(Math.abs(c[1])>90) return [c[0],c[1]];
    return [(c[0]+180)/360*960,(90-c[1])/180*500];
  }

  var topN=mapData.slice(0,16);
  topN.forEach(function(item){
    var c=centroids[item.code.toUpperCase()];
    if(!c) return;
    var pos=toXY(c);
    var cx=pos[0],cy=pos[1];
    var dur=(1.8+Math.random()*1.4).toFixed(1)+'s';

    var g=el('g');

    // Outer glow ring
    var r1=el('circle',{cx:cx,cy:cy,r:10,fill:'rgba(34,197,94,0.06)',stroke:'rgba(34,197,94,0.25)','stroke-width':'1'});
    r1.appendChild(el('animate',{attributeName:'r',values:'6;22;6',dur:dur,repeatCount:'indefinite'}));
    r1.appendChild(el('animate',{attributeName:'opacity',values:'0.7;0;0.7',dur:dur,repeatCount:'indefinite'}));

    // Middle ring
    var r2=el('circle',{cx:cx,cy:cy,r:5,fill:'none',stroke:'rgba(34,197,94,0.55)','stroke-width':'1.2'});
    r2.appendChild(el('animate',{attributeName:'r',values:'3;13;3',dur:dur,repeatCount:'indefinite'}));
    r2.appendChild(el('animate',{attributeName:'opacity',values:'1;0.2;1',dur:dur,repeatCount:'indefinite'}));

    // Solid center dot
    var dot=el('circle',{cx:cx,cy:cy,r:3,fill:'#22c55e',filter:'url(#dotglow)'});

    g.appendChild(r1);g.appendChild(r2);g.appendChild(dot);
    svgEl.appendChild(g);
  });

  // ── Animated scan line ─────────────────────────────────────
  var scan=el('rect',{x:0,y:0,width:960,height:3,fill:'url(#sG)',opacity:'0.8',style:'pointer-events:none'});
  var scanAnim=el('animateTransform',{attributeName:'transform',type:'translate',
    values:'0,0;0,500;0,0',dur:'5.5s',repeatCount:'indefinite'});
  scan.appendChild(scanAnim);
  svgEl.appendChild(scan);

  // Update HUD status
  var st=document.getElementById('mapStatus');
  if(st) st.textContent='FEED ACTIVE // '+mapData.length+' NODES TRACKED';
};

// ── Get Dhaka Time function ─────────────────────────────────
function getDhakaTime() {
  const now = new Date();
  // Convert to Bangladesh Time (UTC+6)
  const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
  const dhakaTime = new Date(utc + (3600000 * 6));
  
  const hours = dhakaTime.getHours().toString().padStart(2, '0');
  const minutes = dhakaTime.getMinutes().toString().padStart(2, '0');
  const seconds = dhakaTime.getSeconds().toString().padStart(2, '0');
  
  return `${hours}:${minutes}:${seconds}`;
}

// ── Auto-init ───────────────────────────────────────────────
document.addEventListener('DOMContentLoaded',function(){
  var sec=document.getElementById('countries');
  if(sec && getComputedStyle(sec).display!=='none'){
    setTimeout(window.drawWorldMap,100);
  }
  document.querySelectorAll('.db-nav-item').forEach(function(item){
    item.addEventListener('click',function(){
      if(item.dataset.section==='countries') setTimeout(window.drawWorldMap,150);
    });
  });
  var rt;
  window.addEventListener('resize',function(){clearTimeout(rt);rt=setTimeout(window.drawWorldMap,300);});

  // HUD clock with Dhaka time
  var clk=document.getElementById('mapClock');
  if(clk) {
    // Initial update
    clk.textContent = getDhakaTime() + ' UTC+6 (Dhaka)';
    
    // Update every second
    setInterval(function(){
      clk.textContent = getDhakaTime() + ' UTC+6 (Dhaka)';
    }, 1000);
  }
});

})();